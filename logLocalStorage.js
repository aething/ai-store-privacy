/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
 * 
 * –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
 * 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
 * 2. –û–Ω –ø–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ, –≤–∫–ª—é—á–∞—è —Å—Ç—Ä–∞–Ω—É –∏ –≤–∞–ª—é—Ç—É
 * 
 * –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏:
 * - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å
 * - –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∫–∞–∫ —Ñ–∞–π–ª JavaScript –≤ –±—Ä–∞—É–∑–µ—Ä
 */

(function checkLoginStatus() {
  console.log("=== –ü–†–û–í–ï–†–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===");
  
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
    const userStr = localStorage.getItem("user");
    
    if (!userStr) {
      console.log("üî¥ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ localStorage");
      console.log("–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É");
      return;
    }
    
    // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = JSON.parse(userStr);
    console.log("üü¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ localStorage");
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä–∞–Ω–µ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞–ª—é—Ç—É
    const country = user.country || "–ù–µ —É–∫–∞–∑–∞–Ω–∞";
    
    let currencyInfo = "USD (–¥–æ–ª–ª–∞—Ä—ã –°–®–ê)";
    let europeanStatus = "–ù–µ –µ–≤—Ä–æ–ø–µ–π—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∞";
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–∞–Ω–∞ –µ–≤—Ä–æ–ø–µ–π—Å–∫–æ–π
    if (country) {
      const euCountries = [
        'AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 
        'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 
        'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'
      ];
      
      if (euCountries.includes(country.toUpperCase())) {
        currencyInfo = "EUR (–µ–≤—Ä–æ)";
        europeanStatus = "–ï–≤—Ä–æ–ø–µ–π—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∞ (–∑–æ–Ω–∞ EUR)";
      }
    }
    
    // –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    console.log(`
=== –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ===
ID: ${user.id || "–ù–µ –∑–∞–¥–∞–Ω"}
–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${user.username || "–ù–µ –∑–∞–¥–∞–Ω–æ"}
Email: ${user.email || "–ù–µ –∑–∞–¥–∞–Ω"}
–°—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: ${user.isVerified ? "‚úì –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω" : "‚úó –ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω"}
–°—Ç—Ä–∞–Ω–∞: ${country}
–í–∞–ª—é—Ç–∞: ${currencyInfo}
–°—Ç–∞—Ç—É—Å —Å—Ç—Ä–∞–Ω—ã: ${europeanStatus}

–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:`, user);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    console.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ...");
    
    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    fetch("/api/users/me", {
      method: "GET",
      headers: {
        "Content-Type": "application/json"
      },
      credentials: "include" // –í–∞–∂–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ cookies
    })
    .then(response => {
      if (response.ok) {
        return response.json().then(serverUser => {
          console.log("üü¢ –°–µ—Å—Å–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∞–∫—Ç–∏–≤–Ω–∞");
          console.log("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞:", serverUser);
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –º–µ–∂–¥—É localStorage –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
          if (serverUser.id === user.id) {
            console.log("‚úì –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã");
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω—ã
            if (serverUser.country !== user.country) {
              console.log("‚ö†Ô∏è –°—Ç—Ä–∞–Ω–∞ –≤ localStorage –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è:");
              console.log(`   - localStorage: ${user.country || "–Ω–µ —É–∫–∞–∑–∞–Ω–∞"}`);
              console.log(`   - –°–µ—Ä–≤–µ—Ä: ${serverUser.country || "–Ω–µ —É–∫–∞–∑–∞–Ω–∞"}`);
              console.log("   –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É —Å –ø–æ–º–æ—â—å—é updateCountry-session.js");
            }
          } else {
            console.log("‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ù–ï —Å–æ–≤–ø–∞–¥–∞—é—Ç");
            console.log(`   - ID –≤ localStorage: ${user.id}`);
            console.log(`   - ID –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: ${serverUser.id}`);
            console.log("   –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö");
          }
        });
      } else {
        console.log("üî¥ –°–µ—Å—Å–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ù–ï –∞–∫—Ç–∏–≤–Ω–∞");
        console.log("–í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ");
        console.log("–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏");
      }
    })
    .catch(error => {
      console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:", error);
    });
    
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:", error);
  }
})();