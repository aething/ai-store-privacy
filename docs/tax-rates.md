# Таблица налоговых ставок и обозначений по странам

| Код страны | Страна | Ставка НДС | Обозначение | Метка в системе | Комментарий |
|------------|--------|------------|-------------|-----------------|-------------|
| DE | Германия | 19% | MwSt. | MwSt. 19% | Стандартная ставка |
| FR | Франция | 20% | TVA | TVA 20% | Стандартная ставка |
| IT | Италия | 22% | IVA | IVA 22% | Стандартная ставка |
| ES | Испания | 21% | IVA | IVA 21% | Стандартная ставка |
| AT | Австрия | 20% | MwSt. | MwSt. 20% | Стандартная ставка |
| BE | Бельгия | 21% | TVA/BTW | TVA 21% | Стандартная ставка |
| GB | Великобритания | 20% | VAT | VAT 20% | Стандартная ставка |
| US | США | 0% | --- | No Sales Tax | Налог на продажи зависит от штата |
| unknown | Неизвестная | 0% | --- | No Tax (Unknown Location) | Страна не определена |

## Особенности обработки

1. **Страны ЕС**: Для всех стран Европейского Союза применяется НДС по ставке соответствующей страны покупателя.
2. **США**: Не применяется федеральный налог с продаж. Налоговая ставка может зависеть от штата, города и округа, но автоматический расчет не реализован.
3. **Неизвестная страна**: Если страна пользователя не определена или не распознана системой, налог не применяется.

## Алгоритм определения страны

Система использует следующую последовательность для определения страны пользователя:

1. Параметр `force_country` в запросе (используется только для тестирования)
2. Параметр `country` в теле запроса
3. Значение из URL-параметров запроса
4. Страна из профиля пользователя
5. Если ни один из вышеперечисленных методов не дал результат, используется "unknown"

## Алгоритм вычисления суммы налога

1. Определяется страна пользователя по описанному выше алгоритму
2. На основе страны выбирается налоговая ставка и метка
3. Сумма налога рассчитывается по формуле: `сумма_налога = базовая_сумма * налоговая_ставка`
4. Результат округляется до целых (до центов/копеек)
5. К базовой сумме добавляется сумма налога для получения итоговой суммы

## Пример расчета

Для пользователя из Германии с базовой суммой 100.00 EUR:
- Налоговая ставка: 19% (0.19)
- Сумма налога: 100.00 * 0.19 = 19.00 EUR
- Итоговая сумма: 100.00 + 19.00 = 119.00 EUR
- Метка налога: "MwSt. 19%"
